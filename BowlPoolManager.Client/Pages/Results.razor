@page "/results"
@using BowlPoolManager.Core.Domain
@using BowlPoolManager.Core
@using BowlPoolManager.Client.Helpers
@inject HttpClient Http

<PageTitle>Game Results</PageTitle>

<div class="container mt-4">
    <div class="text-center mb-5">
        <h1 class="display-4 fw-bold text-primary">Scoreboard</h1>
        <p class="lead text-muted">Scores & Schedules</p>
    </div>

    @if (isLoading)
    {
        <div class="d-flex justify-content-center">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    }
    else
    {
        <div class="card shadow-sm mb-4">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover table-striped mb-0 align-middle">
                        <thead class="table-dark">
                            <tr>
                                <th>Date</th>
                                <th>Bowl / Info</th>
                                <th>Matchup</th>
                                <th class="text-center">Pts</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var game in games.OrderBy(g => g.StartTime))
                            {
                                // Determine Styling for Final Games
                                string homeClass = "";
                                string awayClass = "";
                                
                                if (game.Status == GameStatus.Final)
                                {
                                    if (game.TeamHomeScore > game.TeamAwayScore)
                                    {
                                        homeClass = "text-success fw-bold";
                                        awayClass = "text-danger text-opacity-75";
                                    }
                                    else
                                    {
                                        homeClass = "text-danger text-opacity-75";
                                        awayClass = "text-success fw-bold";
                                    }
                                }
                                else
                                {
                                    // Future Games: Bold the seeded/known teams, standard for TBD
                                    homeClass = string.IsNullOrEmpty(game.TeamHome) ? "text-muted fst-italic" : "fw-bold";
                                    awayClass = string.IsNullOrEmpty(game.TeamAway) ? "text-muted fst-italic" : "fw-bold";
                                }

                                <tr>
                                    <td style="width: 15%">
                                        @DateTimeHelper.ToCentral(game.StartTime).ToString("MMM d")
                                        <div class="small text-muted">@DateTimeHelper.ToCentral(game.StartTime).ToString("h:mm tt")</div>
                                    </td>

                                    <td style="width: 25%">
                                        <strong>@game.BowlName</strong>
                                        @if (game.IsPlayoff)
                                        {
                                            <span class="badge bg-warning text-dark ms-1">Playoff</span>
                                        }
                                        <div class="small text-muted mt-1">
                                            <i class="bi bi-geo-alt"></i> @game.Location
                                            <span class="mx-1">â€¢</span>
                                            <i class="bi bi-tv"></i> @game.Television
                                        </div>
                                    </td>

                                    <td>
                                        <div class="@homeClass d-flex justify-content-between" style="max-width: 300px;">
                                            <span>@(string.IsNullOrEmpty(game.TeamHome) ? "TBD" : game.TeamHome)</span>
                                            @if(game.TeamHomeScore.HasValue)
                                            {
                                                <span>- @game.TeamHomeScore</span>
                                            }
                                        </div>

                                        <div class="@awayClass d-flex justify-content-between mt-1" style="max-width: 300px;">
                                            <span>@(string.IsNullOrEmpty(game.TeamAway) ? "TBD" : game.TeamAway)</span>
                                            @if(game.TeamAwayScore.HasValue)
                                            {
                                                <span>- @game.TeamAwayScore</span>
                                            }
                                        </div>
                                    </td>

                                    <td class="text-center fw-bold fs-5">
                                        @game.PointValue
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    }
</div>

@code {
    private bool isLoading = true;
    private List<BowlGame> games = new();

    protected override async Task OnInitializedAsync()
    {
        try
        {
            games = await Http.GetFromJsonAsync<List<BowlGame>>("api/GetGames") ?? new();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading games: {ex.Message}");
        }
        finally
        {
            isLoading = false;
        }
    }
}
